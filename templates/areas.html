{% extends 'base.html' %}

{% block title %}Home - Nurtura{% endblock %}

{% block content %}
<div class="areas-container">
  <!-- Hero Section (Sticky on Mobile) -->
  <div class="hero-greeting">
    <div class="greeting-content">
      <h1>ðŸ‘‹ Welcome back!</h1>
      <p>Today with {{ baby.baby_name }} ({{ baby.age_months }} months) ðŸŒ±</p>
    </div>
  </div>
  
  <!-- Activities Section -->
  <div class="activities-section">
    <h2>Choose an area to grow together ðŸ’•</h2>
    
    <!-- Tab Navigation (Horizontal Scroll on Mobile) -->
    <div class="tabs-wrapper">
      <div class="tabs-container">
        <button class="tab active" onclick="filterByType(event, 'all')">All</button>
        <button class="tab" onclick="filterByType(event, 'Physical')">ðŸ¤¸ Physical</button>
        <button class="tab" onclick="filterByType(event, 'Cognitive')">ðŸ§  Cognitive</button>
        <button class="tab" onclick="filterByType(event, 'Linguistic')">ðŸ’¬ Linguistic</button>
        <button class="tab" onclick="filterByType(event, 'Social-Emotional')">ðŸ’š Emotional</button>
      </div>
    </div>
    
    <!-- Areas Grid (Mobile: 1 column, Desktop: 3 columns) -->
    <div class="areas-grid" id="areasGrid">
      {% for area in areas %}
      <div class="area-card" data-type="{{ area.development_type }}" 
           onclick="viewActivities({{ area.id }})">
        
        <!-- Background Color -->
        <div class="area-card-background" style="background-color: {{ area.background_color }};">
          <div class="area-header">
            <span class="age-badge">{{ area.age_range_min }}-{{ area.age_range_max }} mo</span>
          </div>
          
          <!-- Area Info -->
          <div class="area-info">
            <h3>{{ area.area_name }}</h3>
            <p>{{ area.description }}</p>
          </div>
          
          <!-- Icon + Now Playing -->
          <div class="area-footer">
            <div class="area-emoji">{{ area.icon_emoji }}</div>
            <span class="now-playing">ðŸ”¥ {{ area.now_playing }} now playing</span>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    
    <!-- Empty State -->
    {% if not areas %}
    <div class="empty-state">
      <p>ðŸ“­ No areas available yet. Please complete onboarding.</p>
      <a href="/onboarding" class="btn-primary">Continue Onboarding âžœ</a>
    </div>
    {% endif %}
  </div>
  
  <!-- CHALLENGES SECTION -->
  {% if challenges %}
  <div class="challenges-section">
    <div class="challenges-content">
      <!-- Header with CTA in top-right -->
      <div class="challenges-header-wrapper">
        <div class="challenges-text">
          <h2 class="challenges-title">Transform Your Parenting Journey</h2>
          <p class="challenges-subtitle">Choose a challenge and commit to 30, 90, 180, or 365 days of growth</p>
        </div>
        <a href="#challenges-grid" class="challenges-announcement-btn">
          <span class="pulse-dot"></span>
          Challenges Now Live ðŸŽ¯
        </a>
      </div>
      
      <!-- 4 Challenge Cards Grid -->
      <div id="challenges-grid" class="challenges-grid">
        {% for challenge in challenges %}
        <div class="challenge-card" onclick="window.location.href='/challenge/{{ challenge.id }}'">
          <div class="challenge-icon-area" style="background: {% if challenge.duration_days == 30 %}rgba(255, 165, 0, 0.15){% elif challenge.duration_days == 90 %}rgba(255, 107, 157, 0.15){% elif challenge.duration_days == 180 %}linear-gradient(135deg, rgba(255, 107, 157, 0.15), rgba(135, 206, 250, 0.15)){% else %}rgba(255, 184, 0, 0.15){% endif %};">
            <span class="challenge-emoji">{{ challenge.cover_image }}</span>
          </div>
          
          <div class="challenge-content">
            <div class="challenge-duration-badge">{{ challenge.duration_days }} Days</div>
            <h3 class="challenge-title">{{ challenge.title }}</h3>
            <p class="challenge-tagline">{{ challenge.tagline }}</p>
            <p class="challenge-description">{{ challenge.description[:80] }}...</p>
          </div>
          
          <div class="challenge-footer">
            <button class="challenge-cta">View Challenge â†’</button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}
</div>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  font-family: "Poppins", "Nunito", "Inter", system-ui, sans-serif;
  background: #FDFAF5;
  -webkit-font-smoothing: antialiased;
}

/* ============================================
   MOBILE-FIRST BASE STYLES
   ============================================ */

.areas-container {
  width: 100%;
  min-height: 100vh;
  padding: 0;
  margin: 0;
  background: #FDFAF5;
}

/* Hero Section */
.hero-greeting {
  background: linear-gradient(135deg, #D4F1E4, #D6E8F7);
  padding: 24px 16px;
  margin: 0 0 16px 0;
  text-align: center;
}

.greeting-content {
  width: 100%;
}

.hero-greeting h1 {
  color: #1A365D;
  font-size: 24px;  /* Mobile: 24px */
  margin: 0 0 8px 0;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.hero-greeting p {
  color: #555;
  font-size: 14px;
  margin: 0;
  line-height: 1.4;
}

/* Activities Section */
.activities-section {
  padding: 20px 16px 80px 16px;
}

.activities-section h2 {
  color: #1A365D;
  font-size: 18px;
  margin: 0 0 16px 0;
  font-weight: 600;
}

/* ============================================
   TABS - MOBILE OPTIMIZED
   ============================================ */

.tabs-wrapper {
  margin-bottom: 20px;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;  /* Smooth scroll on iOS */
  scroll-behavior: smooth;
}

.tabs-container {
  display: flex;
  gap: 8px;
  padding-bottom: 8px;
  min-width: min-content;
  padding-left: 0;
  padding-right: 16px;
}

.tab {
  padding: 10px 14px;
  background: white;
  border: 1.5px solid #E0E0E0;
  border-radius: 20px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
  color: #666;
  white-space: nowrap;
  transition: all 300ms ease;
  min-height: 44px;  /* Mobile: Touch target 44px */
  display: flex;
  align-items: center;
  user-select: none;
  -webkit-user-select: none;
  flex-shrink: 0;
}

.tab:active {
  background: #F0F0F0;
}

.tab:hover {
  border-color: #4CAF50;
  color: #4CAF50;
}

.tab.active {
  background: #4CAF50;
  color: white;
  border-color: #4CAF50;
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
}

/* ============================================
   AREAS GRID - MOBILE-FIRST (1 COLUMN)
   ============================================ */

.areas-grid {
  display: grid;
  grid-template-columns: 1fr;  /* Mobile: 1 column */
  gap: 12px;
  margin-bottom: 40px;
}

.area-card {
  cursor: pointer;
  transition: all 300ms ease;
  height: 100%;
  -webkit-tap-highlight-color: transparent;  /* Remove tap highlight */
}

.area-card:active .area-card-background {
  transform: scale(0.98);
}

.area-card:hover .area-card-background {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
}

.area-card-background {
  border-radius: 16px;
  padding: 16px;
  min-height: 180px;
  max-height: 200px;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  transition: all 300ms ease;
}

.area-header {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 8px;
}

.age-badge {
  background: rgba(255, 255, 255, 0.95);
  color: #1A365D;
  padding: 4px 8px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: 600;
}

.area-info {
  flex: 1;
  margin-bottom: 12px;
  overflow: hidden;
}

.area-info h3 {
  color: #1A365D;
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 6px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  word-break: break-word;
  line-height: 1.3;
}

.area-info p {
  color: #555;
  font-size: 12px;
  margin: 0;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.area-footer {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  flex-shrink: 0;
}

.area-emoji {
  font-size: 40px;
  opacity: 0.9;
}

.now-playing {
  background: rgba(255, 255, 255, 0.95);
  color: #FF6B35;
  padding: 6px 10px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 4px;
  letter-spacing: 0.5px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    opacity: 0.9;
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: 0.9;
  }
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  background: white;
  border-radius: 12px;
}

.empty-state p {
  color: #666;
  margin-bottom: 20px;
  font-size: 14px;
}

/* ============================================
   TABLET & DESKTOP BREAKPOINTS
   ============================================ */

@media (min-width: 768px) {
  /* TABLET: 2 COLUMNS */
  .areas-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  
  .activities-section {
    padding: 30px 24px 40px 24px;
  }
  
  .activities-section h2 {
    font-size: 20px;
  }
  
  .area-card-background {
    min-height: 220px;
    max-height: 240px;
    padding: 20px;
  }
  
  .area-info h3 {
    font-size: 17px;
  }
  
  .area-emoji {
    font-size: 44px;
  }
}

@media (min-width: 1024px) {
  /* DESKTOP: 3 COLUMNS */
  .areas-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .area-card-background {
    min-height: 240px;
    max-height: 260px;
  }
  
  .areas-container {
    padding: 0 20px;
  }
}

@media (min-width: 1200px) {
  /* LARGE DESKTOP */
  .areas-grid {
    grid-template-columns: repeat(4, 1fr);
    max-width: 1400px;
    margin: 0 auto;
  }
}

/* ============================================
   MOBILE TOUCH IMPROVEMENTS
   ============================================ */

@media (hover: none) and (pointer: coarse) {
  /* Touch devices */
  .tab {
    min-height: 48px;
    padding: 12px 16px;
    font-size: 13px;
  }
  
  .area-card {
    -webkit-user-select: none;
    user-select: none;
  }
  
  .area-card-background {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .tab:hover {
    background: white;
    border-color: #E0E0E0;
  }
  
  .tab.active:hover {
    background: #4CAF50;
  }
  
  /* Mobile: Faster pulse animation */
  .now-playing {
    animation: pulse 1.5s infinite;
    font-size: 13px;
  }
}

/* Accessibility: Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  .now-playing {
    animation: none;
  }
}

/* ============================================
   SAFE AREA INSETS (iPhone Notch Support)
   ============================================ */

@supports (padding: max(0px)) {
  .areas-container {
    padding-left: max(16px, env(safe-area-inset-left));
    padding-right: max(16px, env(safe-area-inset-right));
  }
  
  .hero-greeting {
    padding-left: max(16px, env(safe-area-inset-left));
    padding-right: max(16px, env(safe-area-inset-right));
  }
}

/* ============================================
   DARK MODE SUPPORT (Future Phase)
   ============================================ */

@media (prefers-color-scheme: dark) {
  /* Can add dark mode styles here later */
}

/* ============================================
   REDUCED MOTION (Accessibility)
   ============================================ */

@media (prefers-reduced-motion: reduce) {
  .area-card,
  .tab,
  .area-card-background {
    transition: none;
  }
}

/* ============================================
   ORIENTATION: LANDSCAPE
   ============================================ */

@media (max-height: 600px) and (orientation: landscape) {
  .hero-greeting {
    padding: 12px 16px;
  }
  
  .hero-greeting h1 {
    font-size: 20px;
    margin: 0 0 4px 0;
  }
  
  .hero-greeting p {
    font-size: 12px;
  }
  
  .activities-section {
    padding: 12px 16px;
  }
  
  .area-card-background {
    min-height: 140px;
    max-height: 160px;
    padding: 12px;
  }
}

/* ============================================
   CHALLENGES SECTION
   ============================================ */

.challenges-section {
  background: linear-gradient(135deg, #FFF9F0, #FFF5E6);
  padding: 40px 16px 80px 16px;
  margin-top: 32px; /* Reduced from 40px */
}

.challenges-content {
  max-width: 1400px;
  margin: 0 auto;
}

/* Header Wrapper - Title Left, CTA Right */
.challenges-header-wrapper {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-bottom: 32px;
  align-items: center;
}

.challenges-text {
  text-align: center;
  flex: 1;
}

.challenges-title {
  font-size: 24px;
  font-weight: 700;
  color: #1A365D;
  margin-bottom: 8px;
  line-height: 1.3;
}

.challenges-subtitle {
  color: #666;
  font-size: 14px;
  line-height: 1.5;
  margin: 0;
}

/* Pink CTA Button */
.challenges-announcement-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, #FF69B4, #FF1493);
  color: white;
  padding: 12px 24px;
  border-radius: 24px;
  font-weight: 600;
  text-decoration: none;
  box-shadow: 0 4px 12px rgba(255, 105, 180, 0.4);
  animation: pulse 2s infinite;
  cursor: pointer;
  transition: all 300ms ease;
  font-size: 14px;
  white-space: nowrap;
}

.challenges-announcement-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(255, 105, 180, 0.6);
}

.pulse-dot {
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  animation: blink 1.5s infinite;
}

@keyframes blink {
  0%, 50%, 100% { opacity: 1; }
  25%, 75% { opacity: 0.4; }
}

/* Challenges Grid - Mobile First */
.challenges-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 24px;
}

/* Challenge Card - Uniform Size */
.challenge-card {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  cursor: pointer;
  transition: all 300ms ease;
  display: flex;
  flex-direction: column;
  height: 380px; /* Fixed height for uniformity */
}

.challenge-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

/* Icon Area - Fixed 80x80 Container */
.challenge-icon-area {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
  min-height: 120px;
}

.challenge-emoji {
  font-size: 64px;
  line-height: 1;
}

/* Challenge Content */
.challenge-content {
  padding: 20px 20px 16px 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  flex: 1;
}

.challenge-duration-badge {
  background: #F5F1E8;
  color: #1A365D;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  align-self: flex-start;
}

.challenge-title {
  font-size: 17px;
  font-weight: 600;
  color: #1A365D;
  margin: 0;
  line-height: 1.3;
}

.challenge-tagline {
  font-size: 14px;
  font-weight: 500;
  color: #FF6B35;
  margin: 0;
  line-height: 1.3;
}

.challenge-description {
  font-size: 13px;
  color: #888;
  line-height: 1.5;
  margin: 0;
  flex: 1;
}

/* Challenge Footer - Aligned Button */
.challenge-footer {
  padding: 0 20px 20px 20px;
}

.challenge-cta {
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 300ms ease;
  width: 100%;
  display: block;
}

.challenge-cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

/* Tablet - 2 Cards per Row */
@media (min-width: 640px) {
  .challenges-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .challenges-header-wrapper {
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-start;
  }
  
  .challenges-text {
    text-align: left;
  }
}

/* Desktop - 4 Cards per Row */
@media (min-width: 1024px) {
  .challenges-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .challenges-section {
    padding: 50px 24px 100px 24px;
    margin-top: 32px;
  }
  
  .challenges-title {
    font-size: 28px;
  }
  
  .challenges-subtitle {
    font-size: 16px;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .challenges-announcement-btn {
    animation: none;
  }
  
  .pulse-dot {
    animation: none;
  }
  
  .challenge-card {
    transition: none;
  }
  
  .challenge-card:hover {
    transform: none;
  }
}
</style>

<script>
function filterByType(event, type) {
  // Update active tab
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  
  // Scroll active tab into view on mobile
  setTimeout(() => {
    event.target.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
  }, 100);
  
  // Filter cards with animation
  const cards = document.querySelectorAll('.area-card');
  let visibleCount = 0;
  
  cards.forEach((card, index) => {
    if (type === 'all' || card.dataset.type === type) {
      card.style.display = 'block';
      setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, index * 50);
      visibleCount++;
    } else {
      card.style.opacity = '0';
      card.style.transform = 'translateY(10px)';
      setTimeout(() => {
        card.style.display = 'none';
      }, 300);
    }
  });
  
  // Scroll to top of cards on mobile
  if (window.innerWidth < 768) {
    const areasGrid = document.getElementById('areasGrid');
    setTimeout(() => {
      areasGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  }
}

function viewActivities(areaId) {
  // Add loading state
  window.location.href = `/activities/${areaId}`;
}

// Initialize opacity on load
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.area-card').forEach(card => {
    card.style.opacity = '1';
    card.style.transform = 'translateY(0)';
    card.style.transition = 'opacity 300ms ease, transform 300ms ease';
  });
});
</script>
{% endblock %}
