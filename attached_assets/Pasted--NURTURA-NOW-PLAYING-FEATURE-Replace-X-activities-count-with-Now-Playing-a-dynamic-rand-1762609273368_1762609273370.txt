# NURTURA "NOW PLAYING" FEATURE

Replace "X activities" count with "Now Playing" - a dynamic, randomized number (101-999) that changes each time the user visits the app.

**Goal:** Create social proof + urgency by showing parents how many parent-kid games are happening RIGHT NOW globally.

---

## ðŸŽ¯ CONCEPT

**Old (Boring):**
```
Card: "4 activities"
```

**New (Social Proof + Urgency):**
```
Card: "ðŸ”¥ Now Playing: 347"
```

The "347" is randomized between 101-999 every time the user refreshes/revisits.

---

## ðŸ”§ STEP 1: Update Database Schema

### Add this table to store "now playing" state:

```sql
CREATE TABLE app_state (
  id INTEGER PRIMARY KEY DEFAULT 1,
  current_now_playing INTEGER DEFAULT 101,
  last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Initialize with a random number
INSERT INTO app_state (current_now_playing) VALUES (CAST(RANDOM() % 899 + 101 AS INTEGER));
```

---

## ðŸ”§ STEP 2: Create Helper Functions

### Add these functions to `app.py`:

```python
import random

def get_now_playing():
    """
    Get current 'Now Playing' number.
    Returns a number between 101-999.
    """
    state = db.execute('SELECT current_now_playing FROM app_state WHERE id = 1').fetchone()
    
    if not state:
        # Initialize if missing
        random_num = random.randint(101, 999)
        db.execute('INSERT INTO app_state (id, current_now_playing) VALUES (1, ?)', (random_num,))
        db.commit()
        return random_num
    
    return state['current_now_playing']


def update_now_playing():
    """
    Generate a new 'Now Playing' number.
    Call this when user visits the app (to create urgency/novelty).
    """
    new_number = random.randint(101, 999)
    db.execute(
        'UPDATE app_state SET current_now_playing = ?, last_updated = datetime(now) WHERE id = 1',
        (new_number,)
    )
    db.commit()
    return new_number


def refresh_now_playing_if_needed():
    """
    Refresh 'Now Playing' on each page load (creates freshness).
    Optional: Can call with delay to avoid changing too frequently.
    """
    # Always generate new number for maximum urgency
    return update_now_playing()
```

---

## ðŸ”§ STEP 3: Update Home Route

### Find this in `app.py`:

```python
@app.route('/home')
@login_required
def home():
```

### Update it to generate new "Now Playing" number:

```python
@app.route('/home')
@login_required
def home():
    """
    Show areas screen (homepage) with development areas for the baby.
    Generate fresh 'Now Playing' number on each visit.
    """
    user_id = session['user_id']
    baby = get_baby_by_user(user_id)
    
    if not baby:
        return redirect('/onboarding')
    
    # Generate NEW "Now Playing" number on each visit
    now_playing = refresh_now_playing_if_needed()
    print(f"DEBUG: New 'Now Playing' number: {now_playing}")
    
    # Check if areas already generated
    existing_areas = db.execute(
        'SELECT * FROM development_areas WHERE baby_id = ? ORDER BY development_type',
        (baby.id,)
    ).fetchall()
    
    if not existing_areas:
        # First visit: Generate areas based on age + goals
        areas = generate_development_areas(baby)
        
        # Store in DB
        for area in areas:
            db.execute(
                '''INSERT INTO development_areas 
                   (baby_id, area_name, development_type, age_range_min, age_range_max, 
                    icon_emoji, background_color, description, activity_count)
                   VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)''',
                (baby.id, area['name'], area['type'], area['age_min'], 
                 area['age_max'], area['emoji'], area['color'], area['description'], 
                 area.get('activity_count', 3))
            )
        db.commit()
        existing_areas = db.execute(
            'SELECT * FROM development_areas WHERE baby_id = ? ORDER BY development_type',
            (baby.id,)
        ).fetchall()
    
    return render_template('areas.html', 
                         baby=baby, 
                         areas=existing_areas,
                         now_playing=now_playing)  # NEW: Pass to template
```

---

## ðŸ”§ STEP 4: Update HTML Template

### Find in `templates/areas.html`:

```html
<span class="activity-count">{{ area.activity_count }} activities</span>
```

### Replace with:

```html
<span class="now-playing">ðŸ”¥ {{ now_playing }} now playing</span>
```

---

## ðŸ”§ STEP 5: Update CSS

### In `templates/areas.html` `<style>` section, find:

```css
.activity-count {
  background: rgba(255, 255, 255, 0.9);
  color: #1A365D;
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 10px;
  font-weight: 600;
  white-space: nowrap;
}
```

### Replace with:

```css
.now-playing {
  background: rgba(255, 255, 255, 0.95);
  color: #FF6B35;  /* Orange/red for urgency */
  padding: 6px 10px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 4px;
  letter-spacing: 0.5px;
  animation: pulse 2s infinite;  /* Subtle pulse animation */
}

@keyframes pulse {
  0% {
    opacity: 0.9;
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: 0.9;
  }
}

/* Mobile: Make pulse faster */
@media (max-width: 600px) {
  .now-playing {
    animation: pulse 1.5s infinite;
    font-size: 13px;
  }
}

/* Reduce motion accessibility */
@media (prefers-reduced-motion: reduce) {
  .now-playing {
    animation: none;
  }
}
```

---

## ðŸ”§ STEP 6: Update HTML Structure

### In `templates/areas.html`, find this section:

```html
<!-- Icon + Activity Count -->
<div class="area-footer">
  <div class="area-emoji">{{ area.icon_emoji }}</div>
  <span class="activity-count">{{ area.activity_count }} activities</span>
</div>
```

### Replace with:

```html
<!-- Icon + Now Playing -->
<div class="area-footer">
  <div class="area-emoji">{{ area.icon_emoji }}</div>
  <span class="now-playing">ðŸ”¥ {{ now_playing }} now playing</span>
</div>
```

---

## ðŸ“± OPTIONAL: Add Debug Endpoints

### Add these to `app.py` for testing:

```python
@app.route('/debug/now-playing')
def debug_now_playing():
    """Show current 'Now Playing' number"""
    now_playing = get_now_playing()
    return jsonify({
        'now_playing': now_playing,
        'range': '101-999',
        'refreshes_on': 'Each page visit',
        'purpose': 'Social proof + urgency'
    })


@app.route('/debug/now-playing/refresh')
def debug_refresh_now_playing():
    """Manually refresh to see it change"""
    new_number = refresh_now_playing_if_needed()
    return jsonify({
        'new_now_playing': new_number,
        'message': 'Refreshed! Number changed.'
    })


@app.route('/debug/now-playing/set/<int:number>')
def debug_set_now_playing(number):
    """Set a specific number (for testing)"""
    if not (101 <= number <= 999):
        return jsonify({'error': 'Number must be between 101-999'}), 400
    
    db.execute(
        'UPDATE app_state SET current_now_playing = ? WHERE id = 1',
        (number,)
    )
    db.commit()
    
    return jsonify({
        'now_playing': number,
        'message': 'Set to specific number'
    })
```

---

## ðŸ§ª TESTING PROCEDURE

### Test 1: Check Current State

```
GET /debug/now-playing
```

**Response:**
```json
{
  "now_playing": 347,
  "range": "101-999",
  "refreshes_on": "Each page visit",
  "purpose": "Social proof + urgency"
}
```

### Test 2: Refresh Number

```
GET /debug/now-playing/refresh
```

**Response:**
```json
{
  "new_now_playing": 512,
  "message": "Refreshed! Number changed."
}
```

### Test 3: Set Specific Number

```
GET /debug/now-playing/set/500
```

**Response:**
```json
{
  "now_playing": 500,
  "message": "Set to specific number"
}
```

### Test 4: Visual Testing

1. Visit `/home` - see "ðŸ”¥ 347" (example number)
2. Go to another page
3. Come back to `/home` - number should be different (e.g., "ðŸ”¥ 512")
4. Refresh page - number should change again

---

## ðŸ’¾ DATABASE INITIALIZATION

### If you don't have the `app_state` table yet, add this to your database setup:

In your `database.py` or wherever you initialize tables:

```python
def init_db():
    db.execute('''
        CREATE TABLE IF NOT EXISTS app_state (
            id INTEGER PRIMARY KEY DEFAULT 1,
            current_now_playing INTEGER DEFAULT 101,
            last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # Check if app_state has data
    result = db.execute('SELECT COUNT(*) as count FROM app_state').fetchone()
    if result['count'] == 0:
        initial_number = random.randint(101, 999)
        db.execute(
            'INSERT INTO app_state (id, current_now_playing) VALUES (1, ?)',
            (initial_number,)
        )
    
    db.commit()
```

---

## âœ… IMPLEMENTATION CHECKLIST

- [ ] Add `app_state` table to database
- [ ] Add `get_now_playing()` function
- [ ] Add `update_now_playing()` function
- [ ] Add `refresh_now_playing_if_needed()` function
- [ ] Update `/home` route to call `refresh_now_playing_if_needed()`
- [ ] Pass `now_playing` to template in render_template()
- [ ] Update HTML: Remove activity-count, add now-playing
- [ ] Update CSS: Style .now-playing with orange color and pulse animation
- [ ] Add debug endpoints (optional but helpful)
- [ ] Test: Visit `/home` multiple times, verify number changes
- [ ] Test: Kill app (close browser/tab) and reopen, verify number is different
- [ ] Deploy to Replit

---

## ðŸŽ¨ VISUAL RESULT

### Before:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Wiggle & Bounce     â”‚
â”‚ [description]       â”‚
â”‚ ðŸ¤¸    4 activities  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”¥ PSYCHOLOGICAL BENEFITS

1. **Social Proof** - "347 parents playing RIGHT NOW" creates FOMO
2. **Urgency** - Number changes, creating sense of live activity
3. **Credibility** - Shows app is actively used by many parents
4. **Engagement** - Parents curious "why did the number change?"
5. **No Maintenance** - Doesn't depend on real tracking/analytics

---

## ðŸŽ¯ HOW IT WORKS ON APP RESTART

**Session 1:**
- User visits `/home`
- `now_playing = 347`
- Sees: "ðŸ”¥ 347"

**User closes browser/app**

**Session 2 (same day or next day):**
- User visits `/home`
- `now_playing` refreshes
- New random number: `512`
- Sees: "ðŸ”¥ 512"

---

## ðŸ’¡ FUTURE ENHANCEMENTS (Optional)

If you want even more dynamic behavior:

```python
def get_now_playing_realistic():
    """
    More 'realistic' now playing count.
    Can vary based on time of day, day of week, etc.
    """
    import datetime
    
    hour = datetime.datetime.now().hour
    day = datetime.datetime.now().weekday()  # 0=Monday, 6=Sunday
    
    # More people playing in evenings/weekends
    if hour >= 18 or hour <= 9:  # Evening/morning
        base = 400
    elif day >= 5:  # Weekend
        base = 350
    else:  # Weekday afternoon
        base = 200
    
    # Add randomness
    now_playing = base + random.randint(-50, 150)
    now_playing = max(101, min(999, now_playing))  # Clamp to 101-999
    
    return now_playing
```

---

## âœ… FINAL CHECKLIST

- [ ] Database table created and initialized
- [ ] Helper functions added
- [ ] `/home` route updated
- [ ] Template HTML updated (removed activity count, added now-playing)
- [ ] CSS updated (orange color, pulse animation)
- [ ] Debug endpoints added (optional)
- [ ] Tested locally - number changes on each page visit
- [ ] Tested app restart - number is different
- [ ] Pulse animation is smooth and not distracting
- [ ] Mobile responsive (pulse faster on mobile)
- [ ] Accessibility (reduced motion respected)
- [ ] Ready to deploy!

---

## ðŸš€ DEPLOY

Paste this entire prompt into Replit AI and it will:
1. Add database table
2. Create helper functions
3. Update home route
4. Update HTML/CSS
5. Add debug endpoints

Your areas screen will now show dynamic "Now Playing" numbers that change on each visit! ðŸ”¥